---
title: "ingerir"
author: "Fernanda Murillo"
date: "27/4/2021"
output: html_document
---

```{r setup, include=FALSE}
library(xlsx)
library(dplyr)
library(readxl)
library(tidyverse)
library(corrplot)

# Evitar warnings
#options(warn=-1)
```


## IMPORTACIÓN DE DATOS

### READ CLIENTES CSV
```{r}
#CLIENTES
clientes<-read.csv("db/clients.csv", sep = ",", header = T)
head(clientes)
```

### READ PRODUCTOS XLSX
```{r}
#PRODUCTOS
productos<-read.xlsx("db/products.xlsx", sheetIndex = 1)
names(productos)<-c("codigo","nombre","precio","utlidad")
attach(productos)
```

### READ VENTAS TSV
```{r}
#VENTAS
ventas<-read.table("db/sales.tsv",sep = '\t', header = TRUE)
head(ventas, 1)
summary(ventas)
glimpse(ventas)
cor(ventas$MONTO,ventas$SUCURSAL)
#corrplot(cor(ventas$MONTO), method = "color")

for (i in 1:14) {
  boxplot(ventas[,i], main=names(ventas[i]))
}
```


## ELIMINAR VALORES NULOS

### |PRODUCTOS|
```{r}
#PRODUCTOS
which(is.na(productos))
productos <- na.omit(productos) 
```

### |VENTAS|
```{r}
#VENTAS
which(is.na(ventas))
ventas <- na.omit(ventas)
```

### |CLIENTES|
```{r}
#CLIENTES
#which(is.na(clientes))
#clientes <- na.omit(clientes, 1) 
```


## VALORES ATÍPICOS

### |VENTAS|
```{r}
boxplot(ventas$MONTO)
boxplot(ventas$CONSECUTIVO)
```

### |PRODUCTOS|
```{r}
boxplot(productos$codigo)
boxplot(productos$precio)
boxplot(productos$utlidad)
```


## VALORES NO ATÍPICOS

### |PRODUCTOS|
```{r}
productos %>% filter(precio <= 95810) %>%
  summarise(mediana = median(precio))
```

### |VENTAS|
```{r}
ventas %>% filter(MONTO <= 155201) %>%
  summarise(mediana = median(MONTO))
```


## HISTOGRAMA DE LOS DATOS

### |PRODUCTOS|
```{r}
hist(productos$precio, freq = F, col = "pink")
lines(density(productos$precio), col="blue")
```

### |VENTAS|
```{r}
hist(ventas$MONTO, freq = F, col = "pink")
lines(density(ventas$MONTO), col="blue")
```


## TRATAMIENTO DE LOS VALORES ATÍPICOS

### |PRODUCTOS|
```{r}
outlayers <- function(productos,inferior,superior)
{
  data[data < inferior] <- mean(data)
  data[data > superior] <- median(data)
  data
}
```



### Para agregar la nueva columna con los datos tratados

```{r}
cventas<-ventas %>% mutate(c=outlayers(productos$utlidad, 1, 23))
head(cproductos)

boxplot(cproductos$cutlidad)
```

### Creación del modelo de regresión línea simple

```{r}
modelo<-lm(data = cproductos, codigo, nombre, utlidad~cprecio)
```

### Ver los estadísticos del modelo

```{r}
summary(lm_modelo)
```

### 

```{r}
cor.test(cproductos$cprecio,cproductos$cprecio)

plot(cproductos$cprecio$codigo,xlab = "precio",
     ylab = "codigo", main ="Prueba de la regresión lineal " )
abline(lm_modelo,col("blue"))

ggplot(cproductos,aes(cprecio,codigo))+
  geom_point(colours="red")+
  geom_smooth(method = "lm",colour="blue")
```


## EVALUAR LA PREDICCIÓN
```{r}
predict(lm_modelo.data.frame(cprecio=95810))
```

## EVALUAR SOBRE LOS DATOS EXISTENTES
```{r}
resultado<-data.frame(cproductos$cprecio,codigo,lm_modelo$fitted.values, round(codigo-lm_modelo$fitted.values))

names(resultado)<-c("precio","codigo","ventas","diferencia")

view(resultado)

```


